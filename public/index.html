<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>FF Master Tools</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0f0202; 
            --card: #1a0b0b; 
            --text: #f8fafc; 
            --text-mut: #94a3b8;
            --accent: linear-gradient(135deg, #ef4444, #f59e0b);
            --border: #3f1818;
            --nav-bg: rgba(26, 11, 11, 0.95);
        }
        body { background: var(--bg); color: var(--text); font-family: 'Outfit', sans-serif; margin: 0; padding-bottom: 110px; -webkit-tap-highlight-color: transparent; }
        * { box-sizing: border-box; }

        /* ANIMATION */
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .page { display: none; animation: fadeInUp 0.4s cubic-bezier(0.2, 0.8, 0.2, 1); } 
        .page.active { display: block; }

        .container { padding: 20px; max-width: 500px; margin: 0 auto; }

        /* HEADER */
        .header { display: flex; justify-content: space-between; padding: 20px; background: rgba(15, 2, 2, 0.9); backdrop-filter: blur(12px); position: sticky; top: 0; z-index: 50; border-bottom: 1px solid var(--border); }
        .brand { font-size: 22px; font-weight: 800; background: var(--accent); -webkit-background-clip: text; color: transparent; letter-spacing: -0.5px; }
        .coin-badge { background: rgba(245, 158, 11, 0.2); color: #f59e0b; padding: 5px 12px; border-radius: 20px; font-weight: 700; font-size: 14px; border: 1px solid rgba(245, 158, 11, 0.3); }

        /* UI COMPONENTS */
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 24px; padding: 20px; margin-bottom: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.4); }
        .btn { width: 100%; padding: 16px; border: none; border-radius: 16px; font-weight: 700; cursor: pointer; color: white; font-size: 16px; transition: transform 0.1s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn:active { transform: scale(0.98); }
        .btn-grad { background: var(--accent); box-shadow: 0 8px 25px rgba(239, 68, 68, 0.25); }
        
        .input, select { width: 100%; background: #2a1212; border: 1px solid var(--border); padding: 16px; border-radius: 16px; color: white; outline: none; margin-bottom: 15px; font-family: inherit; font-size: 14px; appearance: none; }
        .input:focus { border-color: #ef4444; }

        /* GRID ACTIONS */
        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .action-card { background: #2a1212; border: 1px solid var(--border); border-radius: 16px; padding: 20px; text-align: center; cursor: pointer; transition: 0.2s; position: relative; overflow: hidden;}
        .action-card:active { border-color: #ef4444; transform: scale(0.95); }
        .action-icon { font-size: 32px; margin-bottom: 10px; display: block; }
        .ac-badge { position: absolute; top: 0; right: 0; background: #ef4444; font-size: 10px; padding: 3px 8px; border-bottom-left-radius: 10px; font-weight: bold; }

        /* PROFILE RESULT CARD */
        .ff-profile-card { background: linear-gradient(180deg, #1a0b0b 0%, #2a1212 100%); border: 1px solid #f59e0b; border-radius: 20px; padding: 20px; text-align: center; display: none; margin-bottom: 20px; animation: fadeInUp 0.3s; }
        .ff-avatar { width: 80px; height: 80px; border: 3px solid #f59e0b; border-radius: 12px; margin: 0 auto 10px; }
        .ff-nick { font-size: 20px; font-weight: 800; color: #f59e0b; text-transform: uppercase; letter-spacing: 1px; }
        .ff-stats { display: flex; justify-content: space-between; margin-top: 15px; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 12px; }
        .ff-stat-box { text-align: center; flex: 1; }
        .ff-val { font-weight: 700; color: white; font-size: 16px; }
        .ff-lbl { font-size: 10px; color: #94a3b8; text-transform: uppercase; }

        /* LOGS */
        .log-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid var(--border); }
        .log-item:last-child { border-bottom: none; }

        /* NAV BAR */
        .nav { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 400px; background: var(--nav-bg); backdrop-filter: blur(16px); border-radius: 32px; border: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-around; align-items: center; height: 70px; z-index: 100; padding: 0 10px; box-shadow: 0 20px 40px rgba(0,0,0,0.6); }
        .nav-item { font-size: 24px; color: #64748b; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; border-radius: 16px; cursor: pointer; transition: 0.3s; }
        .nav-item.active { color: #ef4444; background: rgba(239, 68, 68, 0.1); transform: translateY(-5px); }

        /* MODAL */
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 200; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .overlay.open { display: flex; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #ef4444; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 15px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    </style>
</head>
<body>

    <div class="header">
        <div class="brand"><i class="fas fa-fire"></i> FF Tools</div>
        <div class="coin-badge"><i class="fas fa-coins"></i> <span id="coin-bal">0</span></div>
    </div>

    <!-- 1. HOME PAGE -->
    <div id="home-page" class="page active">
        <div class="container">
            <div class="card">
                <h3 style="margin-top:0;">Target Settings</h3>
                <label style="font-size:12px; color:#94a3b8; margin-left:5px;">Target UID</label>
                <input type="number" id="inp-uid" class="input" placeholder="Example: 123456789">

                <label style="font-size:12px; color:#94a3b8; margin-left:5px;">Server Region</label>
                <select id="inp-region" class="input">
                    <option value="ETHIOPIA">Ethiopia (Africa/MENA)</option>
                    <option value="NA">North America</option>
                    <option value="SA">South America</option>
                    <option value="EU">Europe</option>
                    <option value="IND">India</option>
                    <option value="BD">Bangladesh</option>
                </select>
            </div>
            
            <!-- PROFILE RESULT CONTAINER -->
            <div id="profile-result" class="ff-profile-card">
                <img src="" id="res-av" class="ff-avatar">
                <div id="res-nick" class="ff-nick">PLAYER</div>
                <div id="res-bio" style="font-size:12px; font-style:italic; color:#94a3b8; margin-bottom:10px;">Signature</div>
                <div class="ff-stats">
                    <div class="ff-stat-box">
                        <div id="res-lvl" class="ff-val">0</div>
                        <div class="ff-lbl">Level</div>
                    </div>
                    <div class="ff-stat-box">
                        <div id="res-rank" class="ff-val" style="color:#f59e0b;">-</div>
                        <div class="ff-lbl">Rank</div>
                    </div>
                    <div class="ff-stat-box">
                        <div id="res-likes" class="ff-val">0</div>
                        <div class="ff-lbl">Likes</div>
                    </div>
                </div>
            </div>

            <h3 style="margin: 0 0 15px 5px;">Actions</h3>
            <div class="action-grid">
                <!-- Check Info (FREE) -->
                <div class="action-card" onclick="checkProfile()">
                    <div class="ac-badge" style="background:#10b981;">FREE</div>
                    <i class="fas fa-id-card action-icon" style="color: #cbd5e1;"></i>
                    <div style="font-weight:600;">Check Info</div>
                </div>
                
                <!-- Paid Actions -->
                <div class="action-card" onclick="triggerAction('Profile Like')">
                    <div class="ac-badge">5 COINS</div>
                    <i class="fas fa-thumbs-up action-icon" style="color: #60a5fa;"></i>
                    <div style="font-weight:600;">Like Profile</div>
                </div>
                <div class="action-card" onclick="triggerAction('Friend Request')">
                    <div class="ac-badge">5 COINS</div>
                    <i class="fas fa-user-plus action-icon" style="color: #10b981;"></i>
                    <div style="font-weight:600;">Add Friend</div>
                </div>
                <div class="action-card" onclick="triggerAction('Profile Visit')">
                    <div class="ac-badge">5 COINS</div>
                    <i class="fas fa-eye action-icon" style="color: #f59e0b;"></i>
                    <div style="font-weight:600;">Visit</div>
                </div>
                <div class="action-card" onclick="triggerAction('Send Emoji')">
                    <div class="ac-badge">5 COINS</div>
                    <i class="fas fa-smile action-icon" style="color: #f472b6;"></i>
                    <div style="font-weight:600;">Send Emoji</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 2. HISTORY PAGE -->
    <div id="history-page" class="page">
        <div class="container">
            <h3>Transaction History</h3>
            <div class="card" id="history-list"></div>
        </div>
    </div>

    <!-- 3. PROFILE PAGE -->
    <div id="profile-page" class="page">
        <div class="container">
            <div class="card" style="text-align:center;">
                <div style="width:80px; height:80px; background:#2a1212; border-radius:50%; margin:0 auto 15px; display:flex; align-items:center; justify-content:center; border:2px solid #ef4444;">
                    <i class="fas fa-user-astronaut" style="font-size:35px; color:#ef4444;"></i>
                </div>
                <h2 id="u-name">User</h2>
                <p id="u-id" style="color:#94a3b8; font-size:12px;">ID: --</p>
                <div style="margin-top:20px; padding:15px; background:rgba(239,68,68,0.1); border-radius:12px; border:1px solid rgba(239,68,68,0.2);">
                    <div style="font-size:24px; font-weight:800; color:#ef4444;" id="u-coins">0</div>
                    <div style="font-size:12px; color:#f8fafc;">Available Coins</div>
                </div>
            </div>
        </div>
    </div>

    <!-- LOADING MODAL -->
    <div id="loaderModal" class="overlay">
        <div class="card" style="width:300px; text-align:center;">
            <div class="loader"></div>
            <h3 id="loader-txt">Processing...</h3>
            <p style="color:#94a3b8; font-size:13px;">Connecting to Game Server...</p>
        </div>
    </div>

    <!-- NAVIGATION -->
    <div class="nav">
        <div class="nav-item active" id="nav-home" onclick="nav('home')"><i class="fas fa-gamepad"></i></div>
        <div class="nav-item" id="nav-history" onclick="nav('history')"><i class="fas fa-history"></i></div>
        <div class="nav-item" id="nav-profile" onclick="nav('profile')"><i class="fas fa-user"></i></div>
    </div>

    <script>
        const tg = window.Telegram.WebApp; 
        tg.expand();
        const userId = tg.initDataUnsafe?.user?.id?.toString() || '11223344';
        
        function nav(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id+'-page').classList.add('active');
            document.getElementById('nav-'+id).classList.add('active');
            if(id === 'history' || id === 'profile') loadData();
        }

        async function loadData() {
            try {
                const res = await fetch(`/api/user/${userId}`);
                const data = await res.json();
                
                document.getElementById('coin-bal').innerText = data.coins;
                document.getElementById('u-coins').innerText = data.coins;
                document.getElementById('u-name').innerText = tg.initDataUnsafe?.user?.first_name || 'Player';
                document.getElementById('u-id').innerText = `ID: ${userId}`;
                
                if(data.savedUid && !document.getElementById('inp-uid').value) {
                    document.getElementById('inp-uid').value = data.savedUid;
                    document.getElementById('inp-region').value = data.region || 'ETHIOPIA';
                }

                const list = document.getElementById('history-list');
                list.innerHTML = '';
                if(!data.history || data.history.length === 0) {
                    list.innerHTML = '<div style="text-align:center; padding:20px; color:#94a3b8">No activity yet.</div>';
                } else {
                    data.history.forEach(h => {
                        list.innerHTML += `
                        <div class="log-item">
                            <div>
                                <div style="font-weight:600; font-size:14px;">${h.action}</div>
                                <div style="font-size:11px; color:#94a3b8;">UID: ${h.targetUid}</div>
                            </div>
                            <div style="font-size:12px; color:#10b981;">${h.status}</div>
                        </div>`;
                    });
                }
            } catch(e) { console.error(e); }
        }

        // --- NEW FUNCTION: CHECK PROFILE ---
        async function checkProfile() {
            const uid = document.getElementById('inp-uid').value;
            const region = document.getElementById('inp-region').value;

            if(!uid) return tg.showAlert("Please enter a Target UID");
            
            document.getElementById('loader-txt').innerText = "Fetching Info...";
            document.getElementById('loaderModal').classList.add('open');
            document.getElementById('profile-result').style.display = 'none';

            try {
                const res = await fetch('/api/check-profile', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ uid, region })
                });
                const result = await res.json();
                document.getElementById('loaderModal').classList.remove('open');

                if(result.success) {
                    const p = result.data;
                    document.getElementById('res-nick').innerText = p.nickname;
                    document.getElementById('res-lvl').innerText = p.level;
                    document.getElementById('res-rank').innerText = p.rank;
                    document.getElementById('res-likes').innerText = p.likes;
                    document.getElementById('res-bio').innerText = p.bio;
                    document.getElementById('res-av').src = p.avatar;
                    
                    document.getElementById('profile-result').style.display = 'block';
                } else {
                    tg.showAlert(result.error);
                }
            } catch(e) {
                document.getElementById('loaderModal').classList.remove('open');
                tg.showAlert("Network Error");
            }
        }

        async function triggerAction(actionName) {
            const uid = document.getElementById('inp-uid').value;
            const region = document.getElementById('inp-region').value;

            if(!uid) return tg.showAlert("Please enter a Target UID");
            
            document.getElementById('loader-txt').innerText = "Processing...";
            document.getElementById('loaderModal').classList.add('open');

            try {
                const res = await fetch('/api/execute', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ tgId: userId, uid, region, action: actionName })
                });
                const result = await res.json();

                document.getElementById('loaderModal').classList.remove('open');

                if(result.success) {
                    tg.showAlert(result.message);
                    document.getElementById('coin-bal').innerText = result.newCoins;
                    loadData(); // Refresh history
                } else {
                    tg.showAlert("Error: " + result.error);
                }
            } catch(e) {
                document.getElementById('loaderModal').classList.remove('open');
                tg.showAlert("Connection Error");
            }
        }

        loadData();
    </script>
</body>
</html>